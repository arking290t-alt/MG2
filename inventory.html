<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory | MG</title>
  <link rel="stylesheet" href="style.css">

  <style>
    @media print {
      body {
        background: #fff !important;
        color: #000 !important;
      }

      .top-bar,
      .btn,
      .btn-back,
      .btn-logout,
      .filters,
      #categoryList,
      .add-section {
        display: none !important;
      }

      .inventory-item {
        border: 1px solid #000 !important;
        background: #fff !important;
        color: #000 !important;
        box-shadow: none !important;
        padding: 10px !important;
      }
    }
  </style>
</head>

<body class="dashboard-body">

<header class="top-bar">
  <h1 class="logo">MG</h1>
  <div>
    <a href="inventory-management.html" class="btn-back">‚Üê Back</a>
    <button class="btn-logout" onclick="logoutUser()">Logout</button>
  </div>
</header>

<main class="dashboard-center">
  <div class="dashboard-box" style="width:90%;max-width:900px;">

    <h2 class="welcome">Inventory</h2>
    <p class="subtitle">Manage & track all stock</p>

    <!-- PDF BUTTON -->
    <div style="text-align:right;margin-bottom:15px;">
      <button class="btn" onclick="printInventory()">Download Inventory PDF</button>
    </div>

    <!-- CATEGORY FILTERS -->
    <div class="filters" style="margin-bottom:20px;">
      <select id="filterCategory"></select>
      <select id="filterItemName"></select>
      <input type="date" id="filterDate">
      <button id="clearFilters" class="btn-back">Clear</button>
    </div>

    <!-- INVENTORY LIST -->
    <div id="inventoryList"></div>

  </div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore, collection, getDocs
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
    authDomain: "mg-manager-3ab66.firebaseapp.com",
    projectId: "mg-manager-3ab66",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const inventoryList = document.getElementById("inventoryList");
  const filterCategory = document.getElementById("filterCategory");
  const filterItemName = document.getElementById("filterItemName");
  const filterDate = document.getElementById("filterDate");
  const clearFilters = document.getElementById("clearFilters");

  let allInventory = [];

  // PDF PRINT FUNCTION
  window.printInventory = function () {
    const hide = document.querySelectorAll("button, .filters, .add-section");
    hide.forEach(el => el.style.display = "none");

    window.print();

    setTimeout(() => {
      hide.forEach(el => (el.style.display = ""));
    }, 500);
  };

  async function loadInventory() {
    inventoryList.innerHTML = "<p>Loading...</p>";
    const snap = await getDocs(collection(db, "inventory"));
    allInventory = snap.docs.map(d => ({ id: d.id, ...d.data() }));

    renderInventory(allInventory);
  }

  function renderInventory(items) {
    inventoryList.innerHTML = "";

    if (items.length === 0) {
      inventoryList.innerHTML = "<p>No items found.</p>";
      return;
    }

    items.forEach(item => {
      inventoryList.innerHTML += `
        <div class="inventory-item">
          <h3>${item.name}</h3>
          <p>Qty: ${item.qty} ${item.unit}</p>
          <p>Date: ${item.date}</p>
          <p>Category: ${item.category}</p>
        </div>
      `;
    });
  }

  clearFilters.onclick = () => {
    filterCategory.value = "all";
    filterItemName.value = "all";
    filterDate.value = "";
    renderInventory(allInventory);
  };

  loadInventory();
</script>

</body>
</html>
