<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MG Inventory</title>

  <style>
    body {
      background:#0b111b;
      font-family:Poppins, sans-serif;
      color:white;
      margin:0;
      padding:20px;
    }

    .inv-container {
      max-width:1100px;
      margin:auto;
      background:rgba(255,255,255,0.05);
      padding:20px;
      border-radius:15px;
    }

    .section-title {
      font-size:1.4rem;
      font-weight:600;
      margin-bottom:10px;
      color:#00b4ff;
    }

    .row {
      display:flex;
      gap:15px;
      flex-wrap:wrap;
      margin-bottom:15px;
    }

    .input-box {
      flex:1;
      min-width:200px;
      display:flex;
      flex-direction:column;
    }

    .input-box input,
    .input-box select {
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(255,255,255,0.08);
      color:white;
    }

    #addItemBtn {
      width:100%;
      padding:12px;
      background:#00b4ff;
      border:none;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
    }

    .cat-item {
      background:rgba(255,255,255,0.1);
      padding:10px;
      border-radius:8px;
      display:flex;
      justify-content:space-between;
      margin-top:5px;
    }

    .inventory-item {
      background:rgba(255,255,255,0.07);
      padding:15px;
      border-radius:12px;
      margin-top:15px;
    }

    .actions { margin-top:10px; display:flex; gap:12px; }

    .btn {
      padding:7px 14px;
      border:none;
      border-radius:6px;
      font-weight:600;
      cursor:pointer;
    }

    .btn-view { background:#3b82f6; }
    .btn-edit { background:#facc15; color:black; }
    .btn-delete { background:#ef4444; }
    .btn-used { background:#10b981; }

    .filter-row select,
    .filter-row input {
      flex:1;
      min-width:180px;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(255,255,255,0.08);
      color:white;
    }
  </style>
</head>

<body>

<h1 style="text-align:center; color:#00b4ff;">MG Inventory</h1>

<div class="inv-container">

  <div class="section-title">Add Inventory</div>

  <div class="row">
    <div class="input-box"><label>Item Name</label><input id="itemName"></div>
    <div class="input-box"><label>Qty</label><input id="quantity" type="number"></div>
    <div class="input-box">
      <label>Unit</label>
      <select id="unit">
        <option value="PCS">PCS</option>
        <option value="KGS">KGS</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div class="input-box"><label>Price</label><input id="price" type="number"></div>
    <div class="input-box"><label>Invoice No</label><input id="invoice"></div>
    <div class="input-box"><label>Reel No</label><input id="reel"></div>
  </div>

  <div class="row">
    <div class="input-box"><label>Supplier</label><input id="supplier"></div>
    <div class="input-box"><label>GSM</label><input id="gsm" type="number"></div>
    <div class="input-box"><label>BF</label><input id="bf" type="number"></div>
  </div>

  <div class="row">
    <div class="input-box"><label>Date</label><input id="date" type="date"></div>
    <div class="input-box"><label>Category</label><select id="categorySelect"></select></div>
  </div>

  <button id="addItemBtn">Add Item</button>

  <br><br>

  <div class="section-title">Manage Categories</div>
  <div class="row">
    <div class="input-box">
      <label>New Category</label>
      <input id="newCategoryName">
    </div>
    <button id="addCategoryBtn" class="btn" style="background:#00b4ff; margin-top:25px;">Add</button>
  </div>

  <div id="categoryList"></div>

  <br><br>

  <div class="section-title">Filter Inventory</div>

  <div class="filter-row row">
    <select id="filterCategory">
      <option value="all">All Categories</option>
    </select>

    <select id="filterItemName">
      <option value="all">All Items</option>
    </select>

    <input id="filterDate" type="date">
    <button id="clearFilters" class="btn btn-delete">Clear</button>
  </div>

  <div id="inventoryList" style="margin-top:20px;"></div>

</div>

<script type="module">

// FIREBASE
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs,
  deleteDoc, doc, updateDoc, getDoc
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
  authDomain: "mg-manager-3ab66.firebaseapp.com",
  projectId: "mg-manager-3ab66",
  storageBucket: "mg-manager-3ab66.firebasestorage.app",
  messagingSenderId: "330667005987",
  appId: "1:330667005987:web:95de27b6259ace9fc6b996"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// DOM
const itemName = document.getElementById("itemName");
const quantity = document.getElementById("quantity");
const unit = document.getElementById("unit");
const price = document.getElementById("price");
const invoice = document.getElementById("invoice");
const reel = document.getElementById("reel");
const supplier = document.getElementById("supplier");
const gsm = document.getElementById("gsm");
const bf = document.getElementById("bf");
const dateInput = document.getElementById("date");
const categorySelect = document.getElementById("categorySelect");

const inventoryList = document.getElementById("inventoryList");

// CATEGORY LOAD
async function loadCategories() {
  categorySelect.innerHTML = "";
  filterCategory.innerHTML = `<option value="all">All Categories</option>`;

  const snap = await getDocs(collection(db, "inventoryCategories"));
  snap.forEach(c => {
    const name = c.data().name;
    categorySelect.innerHTML += `<option value="${name}">${name}</option>`;
    filterCategory.innerHTML += `<option value="${name}">${name}</option>`;
  });
}

// ADD CATEGORY
addCategoryBtn.onclick = async () => {
  const name = newCategoryName.value.trim();
  if (!name) return;
  await addDoc(collection(db, "inventoryCategories"), { name });
  newCategoryName.value = "";
  loadCategories();
};

// ADD ITEM
addItemBtn.onclick = async () => {
  const data = {
    name: itemName.value,
    qty: Number(quantity.value),
    unit: unit.value,
    price: Number(price.value),
    invoice: invoice.value,
    reel: reel.value,
    supplier: supplier.value,
    gsm: gsm.value,
    bf: bf.value,
    date: dateInput.value,
    category: categorySelect.value
  };

  await addDoc(collection(db, "inventory"), data);

  itemName.value="";
  quantity.value="";
  price.value="";
  invoice.value="";
  reel.value="";
  supplier.value="";
  gsm.value="";
  bf.value="";
  dateInput.value="";

  loadInventory();
};

// LOAD INVENTORY
async function loadInventory() {
  inventoryList.innerHTML = "";
  filterItemName.innerHTML = `<option value="all">All Items</option>`;

  let snap = await getDocs(collection(db, "inventory"));
  let items = [];
  snap.forEach(d => items.push({ id: d.id, ...d.data() }));

  if (filterCategory.value !== "all")
    items = items.filter(i => i.category === filterCategory.value);

  if (filterItemName.value !== "all")
    items = items.filter(i => i.name === filterItemName.value);

  if (filterDate.value)
    items = items.filter(i => i.date === filterDate.value);

  [...new Set(items.map(i => i.name))].forEach(n => {
    filterItemName.innerHTML += `<option value="${n}">${n}</option>`;
  });

  if (!items.length) {
    inventoryList.innerHTML = `<p>No items found.</p>`;
    return;
  }

  items.forEach(item => {
    inventoryList.innerHTML += `
      <div class="inventory-item">
        <h3>${item.name}</h3>
        <p>Qty: ${item.qty} ${item.unit}</p>
        <p>Date: ${item.date}</p>
        <p>Category: ${item.category}</p>

        <div class="actions">
          <button class="btn btn-view">View</button>
          <button class="btn btn-edit">Edit</button>
          <button class="btn btn-used" onclick="useItem('${item.id}')">Used</button>
          <button class="btn btn-delete" onclick="deleteItem('${item.id}')">Delete</button>
        </div>
      </div>
    `;
  });
}

// DELETE ITEM
window.deleteItem = async (id) => {
  if (!confirm("Delete this item?")) return;
  await deleteDoc(doc(db, "inventory", id));
  loadInventory();
};

// USED ITEM â†’ MOVE TO inventoryUsed
window.useItem = async (id) => {
  if (!confirm("Mark this item as USED?")) return;

  const ref = doc(db, "inventory", id);
  const snap = await getDoc(ref);

  if (!snap.exists()) return;

  const item = snap.data();

  await addDoc(collection(db, "inventoryUsed"), {
    ...item,
    usedDate: new Date().toISOString().slice(0,10)
  });

  await deleteDoc(ref);

  alert("Item moved to USED INVENTORY");
  loadInventory();
};

// CLEAR FILTERS
clearFilters.onclick = () => {
  filterCategory.value = "all";
  filterItemName.value = "all";
  filterDate.value = "";
  loadInventory();
};

loadCategories();
loadInventory();

</script>

</body>
</html>
