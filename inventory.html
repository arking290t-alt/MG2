<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MG Inventory</title>

<style>
    body { margin:0; padding:0; font-family:Arial; background:#0c0f17; color:white; }

    h1 { text-align:center; color:#00b4ff; margin:20px 0; }

    .inv-container {
        width:95%; max-width:1250px; margin:auto;
        background:rgba(255,255,255,0.05);
        padding:20px; border-radius:15px;
    }

    .section-title {
        font-size:1.5rem; color:#00b4ff; margin-bottom:15px;
    }

    .row {
        display:flex; gap:15px; flex-wrap:wrap;
    }

    .input-box { flex:1; min-width:240px; display:flex; flex-direction:column; }
    .input-box label { font-size:0.9rem; margin-bottom:5px; color:#a9b; }
    .input-box input, .input-box select {
        padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1);
        background:rgba(255,255,255,0.08); color:white;
    }

    #addItemBtn {
        width:100%; padding:12px; font-size:1.1rem; margin-top:10px;
        background:#00b4ff; border:none; border-radius:10px; font-weight:bold;
    }

    .cat-box { background:rgba(255,255,255,0.07); padding:15px; border-radius:12px; }

    .cat-item { display:flex; justify-content:space-between;
        padding:10px; background:rgba(0,0,0,0.3); border-radius:8px; margin-top:5px;
    }

    .delete-btn { background:#ff3b30; border:none; padding:8px 14px; border-radius:6px; color:white; }

    .inventory-item {
        background:rgba(255,255,255,0.08); padding:15px; margin-top:15px;
        border-radius:12px;
    }

    .actions { display:flex; gap:10px; margin-top:10px; }

    .btn { padding:7px 15px; border:none; border-radius:6px; font-weight:bold; color:white; cursor:pointer; }
    .btn-view { background:#007bff; }
    .btn-edit { background:#ffcc00; color:black; }
    .btn-used { background:#00c853; }
    .btn-delete { background:#e53935; }
    .btn-cancel { background:#555; }

    /* POPUP */
    .popup-bg {
        position:fixed; top:0; left:0; width:100%; height:100%;
        background:rgba(0,0,0,0.7); display:none;
        justify-content:center; align-items:center; z-index:9999;
    }

    .popup {
        background:#111827; padding:20px; width:90%; max-width:450px;
        border-radius:15px;
    }

    .popup h2 { margin-top:0; color:#00b4ff; }
</style>
</head>

<body>

<h1>MG Inventory</h1>

<div class="inv-container">

    <!-- MANAGEMENT -->
    <div class="section-title">Inventory Management</div>

    <div class="row">
        <div class="input-box"><label>Item Name</label><input id="itemName"></div>
        <div class="input-box"><label>Quantity</label><input id="quantity" type="number"></div>
        <div class="input-box"><label>Unit</label>
            <select id="unit"><option value="PCS">PCS</option><option value="KGS">KGS</option></select>
        </div>
    </div>

    <div class="row">
        <div class="input-box"><label>Price (â‚¹)</label><input id="price" type="number"></div>
        <div class="input-box"><label>Invoice</label><input id="invoice"></div>
        <div class="input-box"><label>Reel</label><input id="reel"></div>
    </div>

    <div class="row">
        <div class="input-box"><label>Supplier</label><input id="supplier"></div>
        <div class="input-box"><label>GSM</label><input id="gsm" type="number"></div>
        <div class="input-box"><label>BF</label><input id="bf" type="number"></div>
    </div>

    <div class="row">
        <div class="input-box"><label>Date</label><input id="date" type="date"></div>
        <div class="input-box"><label>Category</label><select id="categorySelect"></select></div>
    </div>

    <button id="addItemBtn">Add Item</button>

    <!-- CATEGORY -->
    <div class="section-title" style="margin-top:25px;">Manage Categories</div>

    <div class="cat-box">
        <div class="row">
            <div class="input-box"><label>New Category</label><input id="newCategoryName"></div>
            <button id="addCategoryBtn" class="btn" style="background:#00b4ff;">Add Category</button>
        </div>

        <div id="categoryList"></div>
    </div>

    <!-- FILTER -->
    <div class="section-title" style="margin-top:30px;">Filter Inventory</div>
    <div class="row">
        <select id="filterCategory" class="input-box">
            <option value="all">All Categories</option>
        </select>
        <select id="filterItemName" class="input-box">
            <option value="all">All Items</option>
        </select>
        <input id="filterDate" type="date" class="input-box">
        <button id="clearFilters" class="btn-delete">Clear</button>
    </div>

    <!-- LIST -->
    <div id="inventoryList" style="margin-top:20px;"></div>
</div>



<!-- POPUP -->
<div id="popupBG" class="popup-bg">
    <div class="popup" id="popupBox"></div>
</div>


<!-- JS + FIREBASE -->
<script type="module">

/* FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey:"AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
    authDomain:"mg-manager-3ab66.firebaseapp.com",
    projectId:"mg-manager-3ab66",
    storageBucket:"mg-manager-3ab66.firebasestorage.app",
    messagingSenderId:"330667005987",
    appId:"1:330667005987:web:95de27b6259ace9fc6b996"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* DOM */
const itemName=document.getElementById("itemName");
const quantity=document.getElementById("quantity");
const unit=document.getElementById("unit");
const price=document.getElementById("price");
const invoice=document.getElementById("invoice");
const reel=document.getElementById("reel");
const supplier=document.getElementById("supplier");
const gsm=document.getElementById("gsm");
const bf=document.getElementById("bf");
const dateInput=document.getElementById("date");
const categorySelect=document.getElementById("categorySelect");

const newCategoryName=document.getElementById("newCategoryName");
const categoryList=document.getElementById("categoryList");

const filterCategory=document.getElementById("filterCategory");
const filterItemName=document.getElementById("filterItemName");
const filterDate=document.getElementById("filterDate");
const inventoryList=document.getElementById("inventoryList");
const popupBG=document.getElementById("popupBG");
const popupBox=document.getElementById("popupBox");

/* POPUP FUNCTIONS */
function showPopup(html){
    popupBox.innerHTML=html;
    popupBG.style.display="flex";
}
function closePopup(){ popupBG.style.display="none"; }

/* LOAD CATEGORIES */
async function loadCategories(){
    categorySelect.innerHTML="";
    filterCategory.innerHTML=`<option value="all">All Categories</option>`;
    categoryList.innerHTML="";

    const snap=await getDocs(collection(db,"inventoryCategories"));
    snap.forEach(d=>{
        let name=d.data().name;
        categorySelect.innerHTML+=`<option value="${name}">${name}</option>`;
        filterCategory.innerHTML+=`<option value="${name}">${name}</option>`;

        categoryList.innerHTML+=`
            <div class='cat-item'>
                <span>${name}</span>
                <button class='delete-btn' onclick="deleteCategory('${d.id}')">Delete</button>
            </div>
        `;
    });
}
window.deleteCategory=async(id)=>{
    if(confirm("Delete this category?")){
        await deleteDoc(doc(db,"inventoryCategories",id));
        loadCategories();
    }
};

/* ADD CATEGORY */
document.getElementById("addCategoryBtn").onclick=async()=>{
    if(!newCategoryName.value.trim())return;
    await addDoc(collection(db,"inventoryCategories"),{name:newCategoryName.value});
    newCategoryName.value="";
    loadCategories();
};

/* ADD ITEM */
document.getElementById("addItemBtn").onclick=async()=>{
    const data={
        name:itemName.value,
        qty:Number(quantity.value),
        unit:unit.value,
        price:Number(price.value),
        invoice:invoice.value,
        reel:reel.value,
        supplier:supplier.value,
        gsm:gsm.value,
        bf:bf.value,
        date:dateInput.value,
        category:categorySelect.value
    };

    await addDoc(collection(db,"inventory"),data);

    itemName.value=""; quantity.value=""; price.value="";
    invoice.value=""; reel.value=""; supplier.value="";
    gsm.value=""; bf.value=""; dateInput.value="";

    loadInventory();
};

/* LOAD INVENTORY */
async function loadInventory(){
    inventoryList.innerHTML="";
    filterItemName.innerHTML=`<option value="all">All Items</option>`;

    let snap=await getDocs(collection(db,"inventory"));
    let items=[];
    snap.forEach(d=>items.push({id:d.id,...d.data()}));

    if(filterCategory.value!=="all")
        items=items.filter(i=>i.category===filterCategory.value);
    if(filterItemName.value!=="all")
        items=items.filter(i=>i.name===filterItemName.value);
    if(filterDate.value)
        items=items.filter(i=>i.date===filterDate.value);

    [...new Set(items.map(i=>i.name))].forEach(n=>{
        filterItemName.innerHTML+=`<option value="${n}">${n}</option>`;
    });

    if(items.length===0){
        inventoryList.innerHTML="<p>No items found.</p>";
        return;
    }

    items.forEach(item=>{
        inventoryList.innerHTML+=`
            <div class='inventory-item'>
                <h3>${item.name}</h3>
                <p>Qty: ${item.qty} ${item.unit}</p>
                <p>Date: ${item.date}</p>
                <p>Category: ${item.category}</p>

                <div class="actions">
                    <button class="btn btn-view" onclick="viewItem('${item.id}')">View</button>
                    <button class="btn btn-edit" onclick="editItem('${item.id}')">Edit</button>
                    <button class="btn btn-used" onclick="useItem('${item.id}')">Used</button>
                    <button class="btn btn-delete" onclick="deleteItem('${item.id}')">Delete</button>
                </div>
            </div>
        `;
    });
}

/* DELETE ITEM */
window.deleteItem=async(id)=>{
    if(confirm("Delete this item?")){
        await deleteDoc(doc(db,"inventory",id));
        loadInventory();
    }
};

/* VIEW POPUP */
window.viewItem=async(id)=>{
    const snap=await getDocs(collection(db,"inventory"));
    let item=[...snap.docs].find(d=>d.id===id).data();

    showPopup(`
        <h2>Item Details</h2>
        <p><b>Name:</b> ${item.name}</p>
        <p><b>Qty:</b> ${item.qty} ${item.unit}</p>
        <p><b>Supplier:</b> ${item.supplier}</p>
        <p><b>Invoice:</b> ${item.invoice}</p>
        <p><b>Reel:</b> ${item.reel}</p>
        <p><b>GSM:</b> ${item.gsm}</p>
        <p><b>BF:</b> ${item.bf}</p>
        <p><b>Category:</b> ${item.category}</p>
        <p><b>Date:</b> ${item.date}</p>
        <button class="btn-cancel" onclick="closePopup()">Close</button>
    `);
};

/* EDIT POPUP */
window.editItem=async(id)=>{
    const snap=await getDocs(collection(db,"inventory"));
    let item=[...snap.docs].find(d=>d.id===id);

    showPopup(`
        <h2>Edit Item</h2>
        <input id="editName" value="${item.data().name}" class="input">
        <input id="editQty" value="${item.data().qty}">
        <button class="btn-edit" onclick="saveEdit('${id}')">Save</button>
        <button class="btn-cancel" onclick="closePopup()">Cancel</button>
    `);
};

window.saveEdit=async(id)=>{
    await updateDoc(doc(db,"inventory",id),{
        name:document.getElementById("editName").value,
        qty:Number(document.getElementById("editQty").value)
    });

    closePopup();
    loadInventory();
};

/* USED POPUP */
window.useItem=async(id)=>{
    if(!confirm("Mark as USED?")) return;

    const snap=await getDocs(collection(db,"inventory"));
    let itemDoc=[...snap.docs].find(d=>d.id===id);

    let item=itemDoc.data();

    await addDoc(collection(db,"inventoryUsed"), item);

    await deleteDoc(doc(db,"inventory",id));

    loadInventory();
};

/* CLEAR FILTER */
document.getElementById("clearFilters").onclick=()=>{
    filterCategory.value="all";
    filterItemName.value="all";
    filterDate.value="";
    loadInventory();
};

loadCategories();
loadInventory();

</script>

</body>
</html>
