<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Inventory | MG</title>

<style>

:root {
  --bg:#0b111b;
  --panel:rgba(255,255,255,0.05);
  --accent:#00b4ff;
  --red:#ef4444;
  --text:#e2e8f0;
}

/* BASE */
body {
  background: var(--bg);
  font-family: Poppins, sans-serif;
  color: var(--text);
  padding: 20px;
}

/* HEADER */
h1 {
  text-align: center;
  color: var(--accent);
  margin-bottom: 25px;
  font-size: 2rem;
}

/* INPUTS */
input, select {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.15);
  background: #1a1f27 !important;
  color: white !important;
  outline: none;
}

select option {
  background: #1a1f27 !important;
  color: white !important;
  padding: 10px;
}

/* BUTTONS */
button {
  padding: 10px 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.add-btn {
  background: var(--accent);
  color: white;
  width: 100%;
}

.red-btn {
  background: var(--red);
  color: white;
}

.edit-btn {
  background: #4ade80;
  color: black;
  margin-right: 8px;
}

/* ITEM CARD */
.item-card {
  background: rgba(255,255,255,0.08);
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 12px;
}

/* CATEGORY TAG */
.category-tag {
  color: var(--accent);
}

/* SECTION TITLE */
.section-title {
  font-size: 1.5rem;
  color: var(--accent);
  margin: 25px 0 10px;
}

</style>
</head>

<body>

<h1>Inventory Management</h1>

<!-- ADD ITEM -->
<div>
  <input id="itemName" type="text" placeholder="Item Name">
  <input id="itemQty" type="number" placeholder="Quantity">
  <input id="purchasePrice" type="number" placeholder="Purchase Price (₹)">
  <input id="itemDate" type="date" placeholder="Date">

  <select id="itemCategory">
    <option value="">Select Category</option>
  </select>

  <button class="add-btn" id="addItem">Add Item</button>
</div>

<hr style="border-color:rgba(255,255,255,0.1);margin:25px 0"/>

<!-- MANAGE CATEGORIES -->
<h2 class="section-title">Manage Categories</h2>

<div style="display:flex;gap:10px;">
  <input id="newCat" type="text" placeholder="New Category Name">
  <button class="add-btn" id="addCat">Add Category</button>
</div>

<div id="categoryList" style="margin-top:15px;"></div>


<hr style="border-color:rgba(255,255,255,0.1);margin:25px 0"/>

<!-- FILTER INVENTORY -->
<h2 class="section-title">Filter Inventory</h2>

<select id="filterCat">
  <option value="all">All Categories</option>
</select>

<br><br>

<input id="filterDate" type="date">

<br><br>

<!-- INVENTORY LIST -->
<div id="inventoryList"></div>


<script type="module">

/* FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { 
  getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc 
} from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
  authDomain: "mg-manager-3ab66.firebaseapp.com",
  projectId: "mg-manager-3ab66",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ELEMENTS */
const itemName = document.getElementById("itemName");
const itemQty = document.getElementById("itemQty");
const purchasePrice = document.getElementById("purchasePrice");
const itemDate = document.getElementById("itemDate");
const itemCategory = document.getElementById("itemCategory");

const newCat = document.getElementById("newCat");
const categoryList = document.getElementById("categoryList");

const filterCat = document.getElementById("filterCat");
const filterDate = document.getElementById("filterDate");
const inventoryList = document.getElementById("inventoryList");


/* LOAD CATEGORIES */
async function loadCategories() {
  const snap = await getDocs(collection(db, "inventoryCategories"));
  itemCategory.innerHTML = `<option value="">Select Category</option>`;
  filterCat.innerHTML = `<option value="all">All Categories</option>`;
  categoryList.innerHTML = "";

  snap.forEach(d => {
    const c = d.data().name;

    // item dropdown
    itemCategory.innerHTML += `<option value="${c}">${c}</option>`;

    // filter dropdown
    filterCat.innerHTML += `<option value="${c}">${c}</option>`;

    // category list
    const row = document.createElement("div");
    row.className = "item-card";
    row.innerHTML = `
      ${c}
      <button class="red-btn" onclick="deleteCategory('${d.id}')">Delete</button>
    `;
    categoryList.appendChild(row);
  });
}


/* ADD CATEGORY */
document.getElementById("addCat").onclick = async () => {
  if (!newCat.value.trim()) return alert("Enter category name");

  await addDoc(collection(db, "inventoryCategories"), {
    name: newCat.value.trim()
  });

  newCat.value = "";
  loadCategories();
};


/* DELETE CATEGORY */
window.deleteCategory = async (id) => {
  await deleteDoc(doc(db, "inventoryCategories", id));
  loadCategories();
};


/* LOAD ITEMS */
async function loadItems() {
  const snap = await getDocs(collection(db, "inventory"));
  inventoryList.innerHTML = "";

  const filterCategory = filterCat.value;
  const filterD = filterDate.value;

  snap.forEach(d => {
    const item = d.data();

    // category filter
    if (filterCategory !== "all" && item.category !== filterCategory) return;

    // date filter
    if (filterD && item.date !== filterD) return;

    createItemCard(item, d.id);
  });
}


/* CREATE ITEM CARD */
function createItemCard(item, id) {
  const div = document.createElement("div");
  div.className = "item-card";

  div.innerHTML = `
    <strong>${item.name}</strong>  
    <br>
    Qty: ${item.qty}  
    <br>
    Price: ₹${item.price}
    <br>
    <span class="category-tag">Category: ${item.category}</span> 
    <br>
    Date: ${item.date}
    <br><br>

    <button class="edit-btn" onclick="editItem('${id}', '${item.name}', '${item.qty}', '${item.price}', '${item.category}', '${item.date}')">Edit</button>

    <button class="red-btn" onclick="deleteItem('${id}')">Delete</button>
  `;

  inventoryList.appendChild(div);
}


/* ADD ITEM */
document.getElementById("addItem").onclick = async () => {
  if (!itemName.value.trim() || !itemQty.value || !purchasePrice.value || !itemCategory.value || !itemDate.value)
    return alert("Fill all fields");

  await addDoc(collection(db, "inventory"), {
    name: itemName.value.trim(),
    qty: parseInt(itemQty.value),
    price: parseFloat(purchasePrice.value),
    category: itemCategory.value,
    date: itemDate.value
  });

  itemName.value = "";
  itemQty.value = "";
  purchasePrice.value = "";
  itemCategory.value = "";
  itemDate.value = "";

  loadItems();
};


/* DELETE ITEM */
window.deleteItem = async (id) => {
  await deleteDoc(doc(db, "inventory", id));
  loadItems();
};


/* EDIT ITEM */
window.editItem = async (id, name, qty, price, category, date) => {
  const newName = prompt("Item Name:", name);
  const newQty = prompt("Quantity:", qty);
  const newPrice = prompt("Price:", price);
  const newDate = prompt("Date (YYYY-MM-DD):", date);

  if (!newName || !newQty || !newPrice || !newDate) return;

  await updateDoc(doc(db, "inventory", id), {
    name: newName,
    qty: parseInt(newQty),
    price: parseFloat(newPrice),
    date: newDate
  });

  loadItems();
};


/* FILTER CHANGES */
filterCat.onchange = loadItems;
filterDate.onchange = loadItems;


/* INIT */
loadCategories();
loadItems();

</script>

</body>
</html>
