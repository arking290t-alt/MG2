<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Inventory | MG</title>

  <style>
    body {
      background:#0b111b;
      color:white;
      font-family:Poppins,sans-serif;
      padding:30px;
    }
    .container {
      max-width:850px;
      margin:auto;
      background:rgba(255,255,255,0.05);
      padding:25px;
      border-radius:16px;
      box-shadow:0 0 25px rgba(0,180,255,0.2);
    }
    h1 {
      text-align:center;
      color:#00b4ff;
      margin-bottom:25px;
      font-size:2rem;
    }
    input, select {
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(255,255,255,0.08);
      color:white;
      outline:none;
      width:100%;
    }
    .row {
      display:flex;
      gap:10px;
      margin-bottom:10px;
    }
    button {
      padding:10px 15px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    .add-btn {
      background:#00b4ff;
      color:white;
      width:150px;
    }
    .item-box {
      background:rgba(255,255,255,0.05);
      padding:15px;
      margin-top:15px;
      border-radius:10px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      border:1px solid rgba(255,255,255,0.09);
    }
    .item-actions button {
      margin:3px;
      padding:5px 12px;
      font-size:0.8rem;
    }
    .delete-btn { background:#ef4444; color:white; }
    .edit-btn { background:#ffd400; color:black; }

    /* Category pills */
    .cat-pill {
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.2);
      padding:6px 10px;
      border-radius:8px;
      margin:5px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .cat-delete-btn {
      background:#ef4444;
      border:none;
      color:white;
      padding:5px 8px;
      border-radius:5px;
    }
  </style>
</head>

<body>

<div class="container">
  <h1>Inventory Management</h1>

  <!-- ADD ITEM -->
  <div class="row">
    <input id="itemName" placeholder="Item Name">
    <input id="itemQty" placeholder="Quantity" type="number">
  </div>

  <div class="row">
    <input id="itemPurchase" placeholder="Purchase Price (₹)" type="number">
  </div>

  <div class="row">
    <select id="itemCategory">
      <option value="">Select Category</option>
    </select>
  </div>

  <button class="add-btn" id="addItemBtn">Add Item</button>

  <hr style="margin:25px 0; border-color:rgba(255,255,255,0.1);">

  <!-- CATEGORY MANAGEMENT -->
  <h2 style="color:#00b4ff;">Manage Categories</h2>

  <div class="row">
    <input id="newCategory" placeholder="New Category Name">
    <button class="add-btn" id="addCategoryBtn">Add Category</button>
  </div>

  <div id="categoryList" style="margin-top:10px;"></div>

  <hr style="margin:25px 0; border-color:rgba(255,255,255,0.1);">

  <!-- CATEGORY FILTER -->
  <h2 style="color:#00b4ff;">Filter Inventory</h2>
  <select id="filterCategory" style="width:200px; margin-bottom:20px;">
    <option value="all">All Categories</option>
  </select>

  <!-- INVENTORY LIST -->
  <div id="inventoryList"></div>
</div>



<!-- FIREBASE SCRIPT -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs,
    deleteDoc, setDoc, doc
  } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
    authDomain: "mg-manager-3ab66.firebaseapp.com",
    projectId: "mg-manager-3ab66",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const itemName = document.getElementById("itemName");
  const itemQty = document.getElementById("itemQty");
  const itemPurchase = document.getElementById("itemPurchase");
  const itemCategory = document.getElementById("itemCategory");
  const categoryList = document.getElementById("categoryList");
  const inventoryList = document.getElementById("inventoryList");

  /* -------------------- LOAD CATEGORIES -------------------- */
  async function loadCategories() {
    const snap = await getDocs(collection(db, "inventoryCategories"));
    itemCategory.innerHTML = `<option value="">Select Category</option>`;
    filterCategory.innerHTML = `<option value="all">All Categories</option>`;
    categoryList.innerHTML = "";

    snap.forEach(d => {
      const c = d.data().name;

      itemCategory.innerHTML += `<option value="${c}">${c}</option>`;
      filterCategory.innerHTML += `<option value="${c}">${c}</option>`;

      categoryList.innerHTML += `
        <div class="cat-pill">
          ${c}
          <button class="cat-delete-btn" onclick="deleteCategory('${d.id}')">Delete</button>
        </div>
      `;
    });
  }

  /* -------------------- ADD CATEGORY -------------------- */
  document.getElementById("addCategoryBtn").onclick = async () => {
    const val = newCategory.value.trim();
    if (!val) return alert("Enter category name");
    await addDoc(collection(db, "inventoryCategories"), { name: val });
    newCategory.value = "";
    loadCategories();
  };

  window.deleteCategory = async (id) => {
    await deleteDoc(doc(db, "inventoryCategories", id));
    loadCategories();
    loadItems();
  };

  /* -------------------- LOAD ITEMS -------------------- */
  async function loadItems() {
    const snap = await getDocs(collection(db, "inventory"));
    inventoryList.innerHTML = "";
    const filter = filterCategory.value;

    snap.forEach(d => {
      const item = d.data();
      if (filter !== "all" && item.category !== filter) return;

      inventoryList.innerHTML += `
        <div class="item-box">
          <div>
            <strong style="font-size:1.1rem;">${item.name}</strong><br>
            ${item.category}<br>
            Qty: ${item.qty}<br>
            Purchase: ₹${item.purchase}
          </div>

          <div class="item-actions">
            <button class="edit-btn" onclick="editItem('${d.id}')">Edit</button>
            <button class="delete-btn" onclick="deleteItem('${d.id}')">Delete</button>
          </div>
        </div>
      `;
    });
  }

  /* -------------------- ADD ITEM -------------------- */
  document.getElementById("addItemBtn").onclick = async () => {
    const name = itemName.value.trim();
    const qty = itemQty.value.trim();
    const purchase = itemPurchase.value.trim();
    const cat = itemCategory.value.trim();

    if (!name || !qty || !purchase || !cat)
      return alert("Fill all fields");

    await addDoc(collection(db, "inventory"), {
      name, qty: Number(qty), purchase: Number(purchase), category: cat
    });

    itemName.value = "";
    itemQty.value = "";
    itemPurchase.value = "";

    loadItems();
  };

  /* -------------------- DELETE ITEM -------------------- */
  window.deleteItem = async (id) => {
    await deleteDoc(doc(db, "inventory", id));
    loadItems();
  };

  /* -------------------- EDIT ITEM -------------------- */
  window.editItem = async (id) => {
    const snap = await getDocs(collection(db, "inventory"));
    snap.forEach(async d => {
      if (d.id === id) {
        const item = d.data();
        const newName = prompt("Item Name", item.name);
        const newQty = prompt("Quantity", item.qty);
        const newPurchase = prompt("Purchase Price", item.purchase);

        await setDoc(doc(db, "inventory", id), {
          name: newName,
          qty: Number(newQty),
          purchase: Number(newPurchase),
          category: item.category
        });

        loadItems();
      }
    });
  };

  filterCategory.onchange = loadItems;

  loadCategories();
  loadItems();
</script>

</body>
</html>
