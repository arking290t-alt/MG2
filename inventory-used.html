<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Used Inventory | MG</title>
  <link rel="stylesheet" href="style.css">

  <style>
    @media print {
      body {
        background: #fff !important;
        color: #000 !important;
      }

      .top-bar,
      .btn,
      .btn-back,
      .btn-logout,
      .filters,
      #fixedTotalBar {
        display: none !important;
      }

      .used-card {
        border: 1px solid #000 !important;
        background: #fff !important;
        color: #000 !important;
        box-shadow: none !important;
        padding: 12px !important;
      }
    }
  </style>
</head>

<body class="dashboard-body">

<header class="top-bar">
  <h1 class="logo">MG</h1>
  <div>
    <a href="inventory-management.html" class="btn-back">‚Üê Back</a>
    <button class="btn-logout" onclick="logoutUser()">Logout</button>
  </div>
</header>

<main class="dashboard-center">
  <div class="dashboard-box" style="width:90%;max-width:900px;">

    <h2 class="welcome">Used Inventory</h2>
    <p class="subtitle">Usage history & deduction records</p>

    <!-- PDF BUTTON -->
    <div style="text-align:right;margin-bottom:15px;">
      <button class="btn" onclick="printUsedInventory()">Download Used Inventory PDF</button>
    </div>

    <div id="usedList"></div>

  </div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore, collection, getDocs
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
    authDomain: "mg-manager-3ab66.firebaseapp.com",
    projectId: "mg-manager-3ab66",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const usedList = document.getElementById("usedList");

  window.printUsedInventory = function () {
    const hide = document.querySelectorAll("button, .filters, #fixedTotalBar");
    hide.forEach(el => el.style.display = "none");

    window.print();

    setTimeout(() => {
      hide.forEach(el => (el.style.display = ""));
    }, 500);
  };

  async function loadUsed() {
    usedList.innerHTML = "<p>Loading...</p>";
    const snap = await getDocs(collection(db, "inventoryUsed"));

    if (snap.empty) {
      usedList.innerHTML = "<p>No usage history.</p>";
      return;
    }

    usedList.innerHTML = "";

    snap.forEach(d => {
      const u = d.data();

      usedList.innerHTML += `
        <div class="used-card" style="margin-bottom:15px;">
          <h3>${u.name}</h3>
          <p>Used Qty: ${u.usedQty} ${u.unit}</p>
          <p>Used For: ${u.usedFor}</p>
          <p>Date: ${u.date}</p>
        </div>
      `;
    });
  }

  loadUsed();
</script>

</body>
</html>
