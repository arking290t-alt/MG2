<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Attendance | MG</title>
  <style>
    body {
      background: #0b111b;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      overflow-x: hidden;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 15px 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      color: #00b4ff;
      font-size: 1.6rem;
      font-weight: 700;
    }

    .btn {
      background: #00b4ff;
      border: none;
      color: #fff;
      font-weight: 600;
      border-radius: 6px;
      padding: 8px 16px;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn:hover {
      opacity: 0.85;
    }

    .container {
      max-width: 1000px;
      margin: 30px auto;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 0 25px rgba(0,180,255,0.07);
      text-align: center;
    }

    h1 {
      color: #00b4ff;
      margin-bottom: 10px;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      justify-content: center;
      align-items: center;
    }

    .day {
      background: rgba(255,255,255,0.04);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 12px 8px;
      text-align: center;
      font-size: 0.85rem;
      transition: all 0.2s ease;
    }

    .day:hover {
      background: rgba(0,180,255,0.15);
      transform: scale(1.05);
    }

    .day span {
      display: block;
      font-size: 0.8rem;
      margin-top: 5px;
      border-radius: 6px;
      padding: 4px;
    }

    .present { background: #16a34a; }
    .halfday { background: #22d3ee; color: #000; }
    .absent { background: #ef4444; }
    .leave { background: #f59e0b; color: #000; }
    .ot { background: #8b5cf6; }

    .salary-bar {
      margin-top: 20px;
      font-weight: 600;
      color: #00b4ff;
    }

    .paid-section {
      margin-top: 20px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 10px;
      text-align: right;
    }

    .paid-input {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
    }

    input {
      background: #0e1724;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #fff;
      padding: 5px 8px;
      width: 140px;
    }

    @media (max-width: 768px) {
      .calendar {
        grid-template-columns: repeat(5, 1fr);
      }
    }

    @media (max-width: 500px) {
      .calendar {
        grid-template-columns: repeat(3, 1fr);
      }
      .day {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">MG</div>
    <div>
      <a href="dashboard.html" class="btn">← Dashboard</a>
      <button class="btn" id="logoutBtn">Logout</button>
    </div>
  </header>

  <div class="container">
    <h1>Attendance Calendar</h1>
    <div id="calendar" class="calendar"></div>
    <div class="salary-bar" id="salaryBar">Earnings this month: ₹0</div>

    <div class="paid-section">
      <div><strong>Paid Records:</strong></div>
      <div id="paidList">No payments yet</div>
      <div class="paid-input">
        <input type="number" id="paidInput" placeholder="Amount ₹" />
        <button class="btn" id="addPaidBtn">Add Payment</button>
      </div>
    </div>
  </div>

  <script>
    const calendarEl = document.getElementById("calendar");
    const salaryBar = document.getElementById("salaryBar");
    const paidListEl = document.getElementById("paidList");
    const paidInput = document.getElementById("paidInput");
    const addPaidBtn = document.getElementById("addPaidBtn");

    const daysInMonth = new Date(2025, 11, 0).getDate();
    let attendance = JSON.parse(localStorage.getItem("attendance")) || {};
    let paidRecords = JSON.parse(localStorage.getItem("paidRecords")) || [];

    function saveAll() {
      localStorage.setItem("attendance", JSON.stringify(attendance));
      localStorage.setItem("paidRecords", JSON.stringify(paidRecords));
    }

    function markDay(day, status) {
      attendance[day] = status;
      saveAll();
      renderCalendar();
    }

    function renderCalendar() {
      calendarEl.innerHTML = "";
      let fullDays = 0, halfDays = 0, totalOT = 0;

      for (let d = 1; d <= daysInMonth; d++) {
        const status = attendance[d] || "No";
        const div = document.createElement("div");
        div.classList.add("day");

        let badge = "";
        if (status.startsWith("OT")) {
          const amount = parseInt(status.split("₹")[1] || 0);
          totalOT += amount;
          badge = `<span class="ot">${status}</span>`;
        } else if (status === "Present") {
          badge = `<span class="present">${status}</span>`;
        } else if (status === "Half Day") {
          badge = `<span class="halfday">${status}</span>`;
        } else if (status === "Absent") {
          badge = `<span class="absent">${status}</span>`;
        } else if (status === "Leave") {
          badge = `<span class="leave">${status}</span>`;
        } else {
          badge = `<span>${status}</span>`;
        }

        div.innerHTML = `${d}${badge}`;
        div.onclick = () => {
          const choice = prompt(
            "Mark Attendance:\n1. Present\n2. Half Day\n3. Absent\n4. Leave\n5. OT (manual rate)\n6. Clear"
          );
          if (choice === "1") markDay(d, "Present");
          else if (choice === "2") markDay(d, "Half Day");
          else if (choice === "3") markDay(d, "Absent");
          else if (choice === "4") markDay(d, "Leave");
          else if (choice === "5") {
            const rate = prompt("Enter OT Amount ₹:");
            if (rate && !isNaN(rate)) markDay(d, "OT ₹" + rate);
          } else if (choice === "6") {
            delete attendance[d];
            saveAll();
            renderCalendar();
          }
        };

        calendarEl.appendChild(div);

        if (status === "Present") fullDays++;
        if (status === "Half Day") halfDays++;
      }

      const monthlySalary = 30000;
      const perDay = monthlySalary / daysInMonth;
      const earnings = fullDays * perDay + halfDays * (perDay / 2) + totalOT;
      salaryBar.textContent = `Earnings this month: ₹${earnings.toFixed(0)} (Full: ${fullDays}, Half: ${halfDays}) + OT ₹${totalOT}`;
      renderPayments(earnings);
    }

    function renderPayments(total) {
      if (paidRecords.length === 0) {
        paidListEl.textContent = "No payments yet";
      } else {
        paidListEl.innerHTML = paidRecords.map(p => `₹${p.amount} on ${p.date}`).join("<br>");
      }

      const paidSum = paidRecords.reduce((a,b) => a + b.amount, 0);
      if (paidSum > 0)
        salaryBar.innerHTML += `<br><span style="color:#ccc;font-size:0.9rem;">Paid: ₹${paidSum} | Remaining: ₹${(total - paidSum).toFixed(0)}</span>`;
    }

    addPaidBtn.onclick = () => {
      const amt = parseFloat(paidInput.value);
      if (!amt || amt <= 0) return alert("Enter valid amount!");
      const today = new Date().toLocaleDateString();
      paidRecords.push({ amount: amt, date: today });
      saveAll();
      paidInput.value = "";
      renderCalendar();
    };

    document.getElementById("logoutBtn").onclick = () => {
      localStorage.removeItem("loggedInUser");
      location.href = "login.html";
    };

    renderCalendar();
  </script>
</body>
</html>

