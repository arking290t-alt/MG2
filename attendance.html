<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Attendance | MG</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: #0b111b;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
    }

    header.top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background: rgba(255,255,255,0.05);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    header .logo {
      font-size: 1.6rem;
      font-weight: 700;
      color: #00b4ff;
    }

    .btn-back, .btn-logout {
      background: #00b4ff;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
    }

    .btn-back:hover, .btn-logout:hover { opacity: 0.85; }

    .attendance-container {
      max-width: 95%;
      margin: 30px auto;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 25px rgba(0,180,255,0.07);
    }

    .calendar-col {
      width: 100%;
      overflow-x: hidden;
    }

    .month-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #00b4ff;
      text-align: center;
      margin-bottom: 12px;
    }

    .weekday {
      text-align: center;
      font-weight: 600;
      color: #aaa;
      padding: 6px 0;
      font-size: 0.85rem;
    }

    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(90px, 1fr));
      gap: 8px;
      margin-top: 12px;
      justify-items: center;
    }

    .cal-day {
      width: 100%;
      aspect-ratio: 1/1;
      background: rgba(255,255,255,0.04);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.07);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: all 0.2s ease;
      font-size: 0.8rem;
      position: relative;
    }

    .cal-day:hover {
      background: rgba(0,180,255,0.12);
      transform: scale(1.04);
      box-shadow: 0 0 10px rgba(0,180,255,0.3);
    }

    .date-num {
      position: absolute;
      top: 6px;
      left: 8px;
      font-size: 0.75rem;
      color: #aaa;
    }

    .badge-sm {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      color: #fff;
    }

    .present { background: #16a34a; }
    .halfday { background: #22d3ee; color: #000; }
    .absent { background: #ef4444; }
    .leave { background: #f59e0b; color: #000; }
    .ot { background: #8b5cf6; }
    .notmarked {
      background: rgba(255,255,255,0.05);
      border: 1px dashed rgba(255,255,255,0.1);
      color: #999;
    }

    .salary-bar {
      margin-top: 18px;
      text-align: center;
      font-size: 0.95rem;
      font-weight: 600;
      color: #00b4ff;
    }

    /* ✅ Responsive calendar */
    @media (max-width: 1024px) {
      .cal-grid { grid-template-columns: repeat(6, 1fr); }
    }

    @media (max-width: 820px) {
      .cal-grid { grid-template-columns: repeat(5, 1fr); }
    }

    @media (max-width: 650px) {
      .cal-grid { grid-template-columns: repeat(4, 1fr); }
    }

    @media (max-width: 500px) {
      .cal-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 5px;
      }
      .cal-day { font-size: 0.7rem; }
      .date-num { font-size: 0.65rem; }
    }

    @media (max-width: 380px) {
      .cal-grid { grid-template-columns: repeat(2, 1fr); }
    }

    /* Paid amount box */
    .paid-box {
      margin-top: 20px;
      text-align: right;
      background: rgba(255,255,255,0.03);
      padding: 10px 15px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.05);
      font-size: 0.85rem;
      color: #ccc;
    }

    .paid-input {
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 6px;
    }

    #paidInput {
      width: 140px;
      padding: 5px 8px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.15);
      background: #0d141e;
      color: #fff;
      font-size: 0.85rem;
    }

    .paid-btn {
      background: #00b4ff;
      border: none;
      color: #fff;
      padding: 5px 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .paid-btn:hover { opacity: 0.85; }
  </style>
</head>
<body>

  <header class="top-bar">
    <div class="logo">MG</div>
    <div>
      <a href="dashboard.html" class="btn-back">← Dashboard</a>
      <button id="logoutBtn" class="btn-logout">Logout</button>
    </div>
  </header>

  <main class="attendance-container">
    <h1 class="month-title">Attendance Calendar</h1>

    <div class="calendar-col">
      <div class="cal-grid" id="calendar"></div>
      <div class="salary-bar" id="salaryBar">Earnings this month: ₹0</div>
      <div class="paid-box">
        <strong>Paid Amounts:</strong>
        <div id="paidList">No payments yet</div>
        <div class="paid-input">
          <input type="number" id="paidInput" placeholder="Amount ₹" />
          <button class="paid-btn" id="addPaidBtn">Add Payment</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    const calendarEl = document.getElementById("calendar");
    const salaryBar = document.getElementById("salaryBar");
    const paidListEl = document.getElementById("paidList");
    const paidInput = document.getElementById("paidInput");
    const addPaidBtn = document.getElementById("addPaidBtn");

    const daysInMonth = new Date(2025, 11, 0).getDate();
    let attendance = JSON.parse(localStorage.getItem("attendance")) || {};
    let paidRecords = JSON.parse(localStorage.getItem("paidRecords")) || [];

    function saveAll() {
      localStorage.setItem("attendance", JSON.stringify(attendance));
      localStorage.setItem("paidRecords", JSON.stringify(paidRecords));
    }

    function markDay(day, status) {
      attendance[day] = status;
      saveAll();
      renderCalendar();
    }

    function renderCalendar() {
      calendarEl.innerHTML = "";
      let fullDays = 0, halfDays = 0, totalOT = 0;

      for (let d = 1; d <= daysInMonth; d++) {
        const status = attendance[d] || "No";
        const box = document.createElement("div");
        box.classList.add("cal-day");

        let badge = "";
        if (status.startsWith("OT")) {
          const amount = parseInt(status.split("₹")[1] || 0);
          totalOT += amount;
          badge = `<span class="badge-sm ot">${status}</span>`;
        } else {
          badge = `<span class="badge-sm ${
            status === "Present"
              ? "present"
              : status === "Half Day"
              ? "halfday"
              : status === "Absent"
              ? "absent"
              : status === "Leave"
              ? "leave"
              : "notmarked"
          }">${status}</span>`;
        }

        box.innerHTML = `<div class="date-num">${d}</div>${badge}`;
        box.onclick = () => {
          const choice = prompt(
            "Mark Attendance:\n1. Present\n2. Half Day\n3. Absent\n4. Leave\n5. OT (manual rate)\n6. Clear"
          );
          if (choice === "1") markDay(d, "Present");
          else if (choice === "2") markDay(d, "Half Day");
          else if (choice === "3") markDay(d, "Absent");
          else if (choice === "4") markDay(d, "Leave");
          else if (choice === "5") {
            const rate = prompt("Enter OT Amount ₹:");
            if (rate && !isNaN(rate)) markDay(d, "OT ₹" + rate);
          } else if (choice === "6") {
            delete attendance[d];
            saveAll();
            renderCalendar();
          }
        };
        calendarEl.appendChild(box);

        if (status === "Present") fullDays++;
        if (status === "Half Day") halfDays++;
      }

      const monthlySalary = 30000; // Example default
      const perDay = monthlySalary / daysInMonth;
      const earnings = fullDays * perDay + halfDays * (perDay / 2) + totalOT;
      salaryBar.textContent = `Earnings this month: ₹${earnings.toFixed(0)} (Full: ${fullDays}, Half: ${halfDays}) + OT ₹${totalOT}`;
      renderPayments(earnings);
    }

    function renderPayments(total) {
      if (paidRecords.length === 0) {
        paidListEl.textContent = "No payments yet";
      } else {
        paidListEl.innerHTML = paidRecords
          .map(p => `₹${p.amount} on ${p.date}`)
          .join("<br>");
      }

      const paidSum = paidRecords.reduce((a,b) => a + b.amount, 0);
      if (paidSum > 0)
        salaryBar.innerHTML += `<br><span style="color:#ccc;font-size:0.85rem;">Paid: ₹${paidSum} | Remaining: ₹${(total - paidSum).toFixed(0)}</span>`;
    }

    addPaidBtn.onclick = () => {
      const amt = parseFloat(paidInput.value);
      if (!amt || amt <= 0) return alert("Enter valid amount!");
      const today = new Date().toLocaleDateString();
      paidRecords.push({ amount: amt, date: today });
      saveAll();
      paidInput.value = "";
      renderCalendar();
    };

    document.getElementById("logoutBtn").onclick = () => {
      localStorage.removeItem("loggedInUser");
      location.href = "login.html";
    };

    renderCalendar();
  </script>
</body>
</html>
