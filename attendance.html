<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attendance Calendar</title>
  <style>
    :root {
      --bg: #0b111b;
      --card: rgba(255, 255, 255, 0.05);
      --accent: #00b4ff;
      --text: #e2e8f0;
      --present: #22c55e;
      --absent: #ef4444;
      --half: #f59e0b;
      --leave: #3b82f6;
      --ot: #a855f7;
    }
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body { background: var(--bg); color: var(--text); margin: 0; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1); }
    .logo { color: var(--accent); font-size: 1.5rem; font-weight: 700; }
    .btn { background: var(--accent); border: none; color: white; padding: 8px 14px; border-radius: 8px; text-decoration: none; font-weight: 600; cursor: pointer; }
    .container { max-width: 950px; margin: 30px auto; background: var(--card); padding: 25px; border-radius: 14px; box-shadow: 0 8px 30px rgba(0, 180, 255, 0.1); }
    h1 { text-align: center; color: var(--accent); margin-bottom: 20px; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
    .day-header { text-align: center; font-weight: 600; opacity: 0.8; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 6px; }
    .day { background: rgba(255, 255, 255, 0.07); border-radius: 10px; padding: 15px; text-align: center; min-height: 70px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 1.1rem; }
    .day:hover { background: rgba(255,255,255,0.12); }
    .present { background: var(--present) !important; color: #fff; }
    .absent { background: var(--absent) !important; color: #fff; }
    .half { background: var(--half) !important; color: #fff; }
    .leave { background: var(--leave) !important; color: #fff; }
    .ot { background: var(--ot) !important; color: #fff; }
    .controls { display: flex; justify-content: space-between; align-items: center; margin: 20px 0; }
    select, button { padding: 8px 12px; border-radius: 8px; border: none; font-weight: 500; }
    .month-nav button { background: var(--accent); color: #fff; margin: 0 5px; }
    .stats { margin-top: 15px; text-align: center; font-weight: 500; }
  </style>
</head>
<body>
  <header>
    <div class="logo">MG</div>
    <a href="dashboard.html" class="btn">← Dashboard</a>
  </header>

  <div class="container">
    <h1>Attendance Calendar</h1>

    <div class="controls">
      <div class="month-nav">
        <button id="prevMonth">◀</button>
        <span id="monthLabel"></span>
        <button id="nextMonth">▶</button>
      </div>
      <select id="staffSelect">
        <option value="">Select Staff</option>
      </select>
    </div>

    <!-- Weekday headers -->
    <div class="calendar" id="weekdays"></div>
    <!-- Dates -->
    <div class="calendar" id="calendarGrid"></div>

    <div class="stats" id="stats"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
      authDomain: "mg-manager-3ab66.firebaseapp.com",
      projectId: "mg-manager-3ab66",
      storageBucket: "mg-manager-3ab66.appspot.com",
      messagingSenderId: "330667005987",
      appId: "1:330667005987:web:95de27b6259ace9fc6b996",
      measurementId: "G-05HW0KSN38"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const monthLabel = document.getElementById("monthLabel");
    const calendarGrid = document.getElementById("calendarGrid");
    const weekdaysEl = document.getElementById("weekdays");

    const weekdays = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
    weekdaysEl.innerHTML = weekdays.map(day => `<div class="day-header">${day}</div>`).join("");

    let currentDate = new Date();

    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const firstDayIndex = (firstDay.getDay() + 6) % 7; // Adjust for Monday start

      monthLabel.textContent = currentDate.toLocaleString("default", { month: "long", year: "numeric" });
      calendarGrid.innerHTML = "";

      // empty cells before first day
      for (let i = 0; i < firstDayIndex; i++) {
        calendarGrid.innerHTML += `<div></div>`;
      }

      // fill days
      for (let d = 1; d <= lastDay.getDate(); d++) {
        const dayDiv = document.createElement("div");
        dayDiv.className = "day";
        dayDiv.textContent = d;
        dayDiv.onclick = () => markAttendance(d);
        calendarGrid.appendChild(dayDiv);
      }
    }

    document.getElementById("prevMonth").onclick = () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    };
    document.getElementById("nextMonth").onclick = () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    };

    renderCalendar();

    async function loadStaff() {
      const staffSelect = document.getElementById("staffSelect");
      const snap = await getDocs(collection(db, "staff"));
      snap.forEach(doc => {
        const data = doc.data();
        const option = document.createElement("option");
        option.value = data.name;
        option.textContent = data.name;
        staffSelect.appendChild(option);
      });
    }

    function markAttendance(day) {
      const staff = document.getElementById("staffSelect").value;
      if (!staff) return alert("Select a staff first!");
      alert(`Mark attendance for ${staff} on ${day} ${monthLabel.textContent}`);
    }

    loadStaff();
  </script>
</body>
</html>
