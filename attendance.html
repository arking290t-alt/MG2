<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Attendance | MG</title>
  <style>
    body {
      background: #0b111b;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      margin: 0;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 15px 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      color: #00b4ff;
      font-size: 1.6rem;
      font-weight: 700;
    }

    .btn {
      background: #00b4ff;
      border: none;
      color: #fff;
      font-weight: 600;
      border-radius: 6px;
      padding: 8px 16px;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn:hover { opacity: 0.85; }

    .container {
      max-width: 1000px;
      margin: 30px auto;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 0 25px rgba(0,180,255,0.07);
    }

    h1 {
      color: #00b4ff;
      text-align: center;
      margin-bottom: 25px;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .day {
      background: rgba(255,255,255,0.04);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 12px 8px;
      text-align: center;
      font-size: 0.85rem;
      transition: all 0.2s ease;
    }

    .day:hover { background: rgba(0,180,255,0.1); }

    .status {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: center;
    }

    .status button {
      border: none;
      padding: 4px 6px;
      border-radius: 6px;
      font-size: 0.7rem;
      color: #fff;
      cursor: pointer;
      transition: 0.2s;
    }

    .present { background: #16a34a; }
    .halfday { background: #22d3ee; color: #000; }
    .absent { background: #ef4444; }
    .leave { background: #f59e0b; color: #000; }
    .ot { background: #8b5cf6; }

    .salary-bar {
      margin-top: 25px;
      text-align: center;
      color: #00b4ff;
      font-weight: 600;
    }

    .paid-section {
      margin-top: 25px;
      text-align: center;
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 15px;
    }

    input {
      background: #0e1724;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #fff;
      padding: 5px 8px;
      width: 140px;
    }

    @media (max-width: 768px) {
      .calendar { grid-template-columns: repeat(5, 1fr); }
    }

    @media (max-width: 500px) {
      .calendar { grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">MG</div>
    <div>
      <a href="dashboard.html" class="btn">← Dashboard</a>
      <button class="btn" id="logoutBtn">Logout</button>
    </div>
  </header>

  <div class="container">
    <h1>Attendance Calendar</h1>
    <div id="calendar" class="calendar"></div>
    <div class="salary-bar" id="salaryBar">Earnings this month: ₹0</div>

    <div class="paid-section">
      <div><strong>Paid Records:</strong></div>
      <div id="paidList">No payments yet</div><br>
      <input type="number" id="paidInput" placeholder="Amount ₹" />
      <button class="btn" id="addPaidBtn">Add Payment</button>
    </div>
  </div>

  <script>
    const calendarEl = document.getElementById("calendar");
    const salaryBar = document.getElementById("salaryBar");
    const paidListEl = document.getElementById("paidList");
    const paidInput = document.getElementById("paidInput");
    const addPaidBtn = document.getElementById("addPaidBtn");

    const daysInMonth = new Date().getDate() > 28 ? 30 : new Date().getDate();
    let attendance = JSON.parse(localStorage.getItem("attendance")) || {};
    let paidRecords = JSON.parse(localStorage.getItem("paidRecords")) || [];

    function saveAll() {
      localStorage.setItem("attendance", JSON.stringify(attendance));
      localStorage.setItem("paidRecords", JSON.stringify(paidRecords));
    }

    function markDay(day, status, otValue = 0) {
      if (status === "OT" && otValue) attendance[day] = "OT ₹" + otValue;
      else attendance[day] = status;
      saveAll();
      renderCalendar();
    }

    function renderCalendar() {
      calendarEl.innerHTML = "";
      const monthDays = 30;
      let fullDays = 0, halfDays = 0, totalOT = 0;

      for (let d = 1; d <= monthDays; d++) {
        const div = document.createElement("div");
        div.classList.add("day");
        const dayStatus = attendance[d] || "No";
        let color = "";
        if (dayStatus.startsWith("OT")) color = "ot";
        else if (dayStatus === "Present") color = "present";
        else if (dayStatus === "Half Day") color = "halfday";
        else if (dayStatus === "Absent") color = "absent";
        else if (dayStatus === "Leave") color = "leave";

        div.innerHTML = `<strong>${d}</strong><br><span class="${color}">${dayStatus}</span>
          <div class="status">
            <button class="present" onclick="markDay(${d}, 'Present')">P</button>
            <button class="halfday" onclick="markDay(${d}, 'Half Day')">½</button>
            <button class="absent" onclick="markDay(${d}, 'Absent')">A</button>
            <button class="leave" onclick="markDay(${d}, 'Leave')">L</button>
            <button class="ot" onclick="setOT(${d})">OT</button>
          </div>`;

        if (dayStatus === "Present") fullDays++;
        if (dayStatus === "Half Day") halfDays++;
        if (dayStatus.startsWith("OT")) totalOT += parseFloat(dayStatus.split("₹")[1] || 0);

        calendarEl.appendChild(div);
      }

      const monthlySalary = 30000;
      const perDay = monthlySalary / monthDays;
      const earnings = fullDays * perDay + halfDays * (perDay / 2) + totalOT;
      salaryBar.innerHTML = `Earnings this month: ₹${earnings.toFixed(0)}<br>Per Day: ₹${perDay.toFixed(0)} (Full: ${fullDays}, Half: ${halfDays}, OT: ₹${totalOT})`;

      renderPayments(earnings);
    }

    function setOT(day) {
      const rate = prompt("Enter OT rate ₹:");
      if (rate && !isNaN(rate)) markDay(day, "OT", rate);
    }

    function renderPayments(total) {
      if (paidRecords.length === 0) paidListEl.textContent = "No payments yet";
      else paidListEl.innerHTML = paidRecords.map(p => `₹${p.amount} on ${p.date}`).join("<br>");

      const paidSum = paidRecords.reduce((a,b) => a + b.amount, 0);
      if (paidSum > 0)
        salaryBar.innerHTML += `<br><span style="color:#ccc;font-size:0.9rem;">Paid: ₹${paidSum} | Remaining: ₹${(total - paidSum).toFixed(0)}</span>`;
    }

    addPaidBtn.onclick = () => {
      const amt = parseFloat(paidInput.value);
      if (!amt || amt <= 0) return alert("Enter valid amount!");
      const today = new Date().toLocaleDateString();
      paidRecords.push({ amount: amt, date: today });
      saveAll();
      paidInput.value = "";
      renderCalendar();
    };

    document.getElementById("logoutBtn").onclick = () => {
      localStorage.removeItem("loggedInUser");
      location.href = "login.html";
    };

    renderCalendar();
  </script>
</body>
</html>

