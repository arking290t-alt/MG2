<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Export PDF | MG</title>

  <style>
    body { background:#0b111b;color:white;font-family:Poppins;padding:20px;text-align:center; }
    .box {
      background:rgba(255,255,255,0.05);
      padding:25px;
      border-radius:12px;
      max-width:500px;
      margin:auto;
    }
    .btn {
      background:#00b4ff;
      border:none;
      padding:12px 20px;
      border-radius:10px;
      color:white;
      font-weight:600;
      cursor:pointer;
      margin-top:10px;
      width:100%;
    }
    .btn:hover { opacity:0.8; }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>

<div class="box">
  <h1 style="color:#00b4ff;">Export PDF</h1>
  <p>Select what you want to download</p>

  <button class="btn" onclick="downloadInventoryPDF()">Download Inventory PDF</button>
  <button class="btn" onclick="downloadUsedPDF()">Download Used Inventory PDF</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
  authDomain: "mg-manager-3ab66.firebaseapp.com",
  projectId: "mg-manager-3ab66",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function dateFormat(d){
  if (!d) return "";
  return d.replace("T"," ").split(".")[0];
}

// --------------------------------------------------
// ðŸ“Œ INVENTORY PDF (Professional Table Format)
// --------------------------------------------------
window.downloadInventoryPDF = async function () {
  const { jsPDF } = window.jspdf;
  let pdf = new jsPDF({ orientation: "portrait", unit: "pt", format: "A4" });

  pdf.setFontSize(18);
  pdf.text("MG Inventory Report", 40, 40);

  const snap = await getDocs(collection(db, "inventory"));

  let tableData = [];
  let index = 1;

  snap.forEach(d => {
    let it = d.data();
    let amount = (Number(it.qty) || 0) * (Number(it.price) || 0);

    tableData.push([
      index,
      it.name || "",
      (it.qty || 0) + " " + (it.unit || ""),
      "â‚¹" + (it.price || 0),
      "â‚¹" + amount,
      it.category || "",
      it.date || ""
    ]);

    index++;
  });

  pdf.autoTable({
    startY: 70,
    head: [["S/N", "Item", "Qty", "Price", "Amount", "Category", "Date"]],
    body: tableData,
    theme: "grid",
    headStyles: { fillColor: [0, 180, 255], textColor: 255 },
    styles: { fontSize: 10, cellPadding: 5 },
    alternateRowStyles: { fillColor: [230, 247, 255] }
  });

  pdf.save("inventory-report.pdf");
};

// --------------------------------------------------
// ðŸ“Œ USED INVENTORY PDF (Professional Table Format)
// --------------------------------------------------
window.downloadUsedPDF = async function () {
  const { jsPDF } = window.jspdf;
  let pdf = new jsPDF({ orientation: "portrait", unit: "pt", format: "A4" });

  pdf.setFontSize(18);
  pdf.text("MG Used Inventory Report", 40, 40);

  const snap = await getDocs(collection(db, "inventoryUsed"));

  let tableData = [];
  let index = 1;

  snap.forEach(d => {
    let it = d.data();

    tableData.push([
      index,
      it.name || "",
      (it.qty || 0) + " " + (it.unit || ""),
      "â‚¹" + (it.price || 0),
      "â‚¹" + (it.amount || 0),
      it.usedFor || "",
      dateFormat(it.usedAt)
    ]);

    index++;
  });

  pdf.autoTable({
    startY: 70,
    head: [["S/N", "Item", "Qty", "Price", "Amount", "Used For", "Used At"]],
    body: tableData,
    theme: "grid",
    headStyles: { fillColor: [0, 180, 255], textColor: 255 },
    styles: { fontSize: 10, cellPadding: 5 },
    alternateRowStyles: { fillColor: [230, 247, 255] }
  });

  pdf.save("used-inventory-report.pdf");
};

</script>

</body>
</html>
