<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory PDF Export | MG</title>
  <style>
    body {
      background:#0b111b;
      font-family:Poppins, sans-serif;
      color:white;
      padding:30px;
    }
    .box {
      max-width:900px;
      margin:auto;
      background:rgba(255,255,255,0.06);
      padding:25px;
      border-radius:16px;
    }
    h1 {
      color:#00b4ff;
      margin-bottom:10px;
    }
    label {
      font-size:14px;
      color:#c7d2e2;
    }
    input[type="month"] {
      padding:10px;
      width:250px;
      margin-top:10px;
      margin-bottom:20px;
      border-radius:10px;
      border:none;
      font-size:1rem;
    }
    button {
      background:#00b4ff;
      border:none;
      padding:12px 18px;
      color:white;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      margin-right:10px;
    }
    table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
      background:white;
      color:black;
      font-size:14px;
    }
    th, td {
      padding:10px;
      border:1px solid #ccc;
    }
    th {
      background:#f2f2f2;
      font-weight:700;
    }
  </style>
</head>

<body>

<div class="box">
  <h1>Inventory PDF Export</h1>

  <label>Select Month</label><br>
  <input type="month" id="monthInput">

  <div style="margin-top:15px;">
    <button id="downloadInventory">Download Inventory PDF</button>
    <button id="downloadUsed">Download Used Inventory PDF</button>
  </div>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, getDocs, collection } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
    authDomain: "mg-manager-3ab66.firebaseapp.com",
    projectId: "mg-manager-3ab66",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);


  // -----------------------
  // FUNCTION: PRINT WINDOW
  // -----------------------
  function openPrintWindow(title, month, tableHTML) {
    const win = window.open("", "_blank");

    win.document.write(`
      <html>
      <head>
        <title>${title}</title>
        <style>
          body { font-family: Arial; padding:20px; }
          table { width:100%; border-collapse:collapse; margin-top:20px; }
          th, td { border:1px solid #555; padding:8px; text-align:left; }
          th { background:#eaeaea; }
        </style>
      </head>
      <body>
        <h2>${title}</h2>
        <p><strong>Month:</strong> ${month}</p>
        ${tableHTML}
      </body>
      </html>
    `);

    win.document.close();
    win.print();
  }



  // -----------------------
  // INVENTORY PDF BUTTON
  // -----------------------
  document.getElementById("downloadInventory").onclick = async () => {
    const month = document.getElementById("monthInput").value;
    if (!month) return alert("Select a month");

    const snap = await getDocs(collection(db, "inventory"));
    let items = snap.docs.map(d => ({ id: d.id, ...d.data() }))
                         .filter(i => i.date?.startsWith(month));

    if (items.length === 0) return alert("No inventory found for this month.");

    let total = 0;
    let rows = items.map((item, i) => {
      const amt = item.qty * item.price;
      total += amt;
      return `
        <tr>
          <td>${i+1}</td>
          <td>${item.name}</td>
          <td>${item.qty}</td>
          <td>${item.unit}</td>
          <td>₹${item.price}</td>
          <td>₹${amt.toFixed(2)}</td>
          <td>${item.date}</td>
        </tr>`;
    }).join("");

    const table = `
      <table>
        <tr>
          <th>#</th>
          <th>Item</th>
          <th>Qty</th>
          <th>Unit</th>
          <th>Price</th>
          <th>Amount</th>
          <th>Date</th>
        </tr>
        ${rows}
      </table>
      <h3>Total Amount: ₹${total.toFixed(2)}</h3>
    `;

    openPrintWindow("Inventory Report", month, table);
  };



  // -----------------------
  // USED INVENTORY PDF BUTTON
  // -----------------------
  document.getElementById("downloadUsed").onclick = async () => {
    const month = document.getElementById("monthInput").value;
    if (!month) return alert("Select a month");

    const snap = await getDocs(collection(db, "inventoryUsed"));
    let items = snap.docs.map(d => ({ id: d.id, ...d.data() }))
                         .filter(i => i.date?.slice(0,7) === month);

    if (items.length === 0) return alert("No used inventory found for this month.");

    let rows = items.map((item, i) => `
      <tr>
        <td>${i+1}</td>
        <td>${item.name}</td>
        <td>${item.usedQty}</td>
        <td>${item.unit}</td>
        <td>${item.usedFor}</td>
        <td>${item.date}</td>
      </tr>
    `).join("");

    const table = `
      <table>
        <tr>
          <th>#</th>
          <th>Item</th>
          <th>Used Qty</th>
          <th>Unit</th>
          <th>Used For</th>
          <th>Date</th>
        </tr>
        ${rows}
      </table>
    `;

    openPrintWindow("Used Inventory Report", month, table);
  };

</script>

</body>
</html>
