<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expenses | MG</title>
  <style>
    :root {
      --bg:#0b111b;
      --card:rgba(255,255,255,0.05);
      --accent:#00b4ff;
      --panel:#101820;
      --border:rgba(255,255,255,0.1);
    }
    *{box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{
      background:var(--bg);
      color:#fff;
      margin:0;
      min-height:100vh;
    }
    header{
      display:flex;justify-content:space-between;align-items:center;
      background:rgba(255,255,255,0.05);
      padding:15px 25px;border-bottom:1px solid var(--border);
    }
    .logo{color:var(--accent);font-size:1.5rem;font-weight:700;}
    .btn{
      background:var(--accent);color:#fff;border:none;
      padding:8px 14px;border-radius:8px;cursor:pointer;
      text-decoration:none;font-weight:600;
    }
    .btn:hover{opacity:.9;}
    .container{
      max-width:950px;
      margin:40px auto;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      padding:30px 25px;
      box-shadow:0 8px 30px rgba(0,180,255,0.05);
    }
    h1{text-align:center;color:var(--accent);margin:5px 0 25px;}
    .controls{
      display:flex;flex-wrap:wrap;justify-content:center;gap:15px;margin-bottom:20px;
    }
    label{font-size:.9rem;color:#9fbcdff0;}
    select,input[type="month"],input[type="text"],input[type="number"],input[type="date"]{
      background:var(--panel);border:1px solid var(--border);
      color:#fff;padding:8px 10px;border-radius:8px;outline:none;
    }
    .expense-list{margin-top:10px;}
    .expense-item{
      background:rgba(255,255,255,0.05);
      padding:12px 16px;border-radius:10px;margin-bottom:10px;
      display:flex;justify-content:space-between;align-items:center;
      border:1px solid rgba(255,255,255,0.06);
    }
    .expense-item .amt{color:var(--accent);font-weight:700;}
    .expense-item small{color:#a9c8df;}
    .summary{
      margin-top:15px;text-align:center;font-weight:700;color:var(--accent);
    }
    .add-row{
      display:flex;flex-wrap:wrap;justify-content:center;gap:10px;
      margin-top:25px;
    }
    .add-row input,.add-row select{
      background:var(--panel);
      border:1px solid var(--border);
      color:#fff;padding:8px 10px;border-radius:8px;
    }
    .muted{text-align:center;margin-top:25px;color:#9aa9b6;}
    .category-section{
      margin-top:40px;text-align:center;
    }
    .category-list{
      display:flex;flex-wrap:wrap;justify-content:center;gap:8px;
      margin-top:15px;
    }
    .category-item{
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      padding:6px 10px;border-radius:6px;
      display:flex;align-items:center;gap:6px;
    }
    .category-item button{
      background:#ef4444;border:none;color:white;padding:3px 7px;
      border-radius:4px;cursor:pointer;
    }
    @media(max-width:720px){
      .controls,.add-row{gap:8px;padding:0 8px;}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">MG</div>
    <div>
      <a href="dashboard.html" class="btn">← Dashboard</a>
      <button id="logoutBtn" class="btn">Logout</button>
    </div>
  </header>

  <div class="container">
    <h1>Expense Tracker</h1>

    <div class="controls">
      <div>
        <label>Category</label>
        <select id="categoryFilter">
          <option value="all">All Categories</option>
        </select>
      </div>

      <div>
        <label>Time</label>
        <input type="month" id="timeFilter">
        <button id="clearTime" class="btn" style="background:transparent;border:1px solid var(--border);color:#fff;">Clear</button>
      </div>
    </div>

    <div id="expenseList" class="expense-list"></div>
    <div id="summaryText" class="summary">Total: ₹0</div>

    <div class="add-row">
      <input id="expenseName" type="text" placeholder="Expense name">
      <input id="expenseAmount" type="number" placeholder="Amount ₹">
      <select id="expenseCategory"></select>
      <input id="expenseDate" type="date">
      <button id="addExpenseBtn" class="btn">Add Expense</button>
    </div>

    <div class="muted">
      Add category:
      <input id="newCategory" type="text" placeholder="New Category name" style="min-width:180px;margin-left:8px;">
      <button id="addCategoryBtn" class="btn">Add Category</button>
    </div>

    <div class="category-section">
      <h3 style="color:#00b4ff;">Manage Categories</h3>
      <div id="categoryList" class="category-list"></div>
    </div>
  </div>

  <script>
    const EXP_KEY='expenses',CAT_KEY='categories';
    let expenses=JSON.parse(localStorage.getItem(EXP_KEY))||[];
    let categories=JSON.parse(localStorage.getItem(CAT_KEY))||['Food','Travel','Bills','Salary','Other'];

    const expenseListEl=document.getElementById('expenseList');
    const categoryFilter=document.getElementById('categoryFilter');
    const timeFilter=document.getElementById('timeFilter');
    const clearTime=document.getElementById('clearTime');
    const expenseCategory=document.getElementById('expenseCategory');
    const summaryText=document.getElementById('summaryText');
    const categoryListEl=document.getElementById('categoryList');

    function saveAll(){
      localStorage.setItem(EXP_KEY,JSON.stringify(expenses));
      localStorage.setItem(CAT_KEY,JSON.stringify(categories));
    }

    function renderCategories(){
      categoryFilter.innerHTML='<option value="all">All Categories</option>'+
      categories.map(c=>`<option value="${c}">${c}</option>`).join('');
      expenseCategory.innerHTML=categories.map(c=>`<option value="${c}">${c}</option>`).join('');
      categoryListEl.innerHTML='';
      categories.forEach(cat=>{
        const div=document.createElement('div');
        div.className='category-item';
        div.innerHTML=`${cat} <button onclick="deleteCategory('${cat}')">❌</button>`;
        categoryListEl.appendChild(div);
      });
    }

    function renderExpenses(){
      expenseListEl.innerHTML='';
      const cat=categoryFilter.value,time=timeFilter.value;
      const filtered=expenses.filter(e=>{
        const matchesCat=(cat==='all')||(e.category===cat);
        const matchesTime=!time||e.date.startsWith(time);
        return matchesCat&&matchesTime;
      });
      if(!filtered.length){
        expenseListEl.innerHTML='<p style="text-align:center;color:#888;">No expenses found</p>';
      }else{
        filtered.forEach((exp,i)=>{
          const div=document.createElement('div');
          div.className='expense-item';
          div.innerHTML=`
          <div>
            <strong>${exp.name}</strong><br><small>${exp.category} | ${exp.date}</small>
          </div>
          <div>
            <span class="amt">₹${exp.amount}</span>
            <button onclick="deleteExpense(${i})" style="background:#ef4444;border:none;color:white;padding:4px 8px;border-radius:6px;">Delete</button>
          </div>`;
          expenseListEl.appendChild(div);
        });
      }
      const total=filtered.reduce((s,e)=>s+e.amount,0);
      summaryText.textContent=`Total: ₹${total}`;
    }

    document.getElementById('addExpenseBtn').onclick=()=>{
      const name=document.getElementById('expenseName').value.trim();
      const amt=parseFloat(document.getElementById('expenseAmount').value);
      const cat=expenseCategory.value;
      const date=document.getElementById('expenseDate').value||new Date().toISOString().slice(0,10);
      if(!name||!amt)return alert('Enter valid details!');
      expenses.push({name,amount:amt,category:cat,date});
      saveAll();renderExpenses();
      document.getElementById('expenseName').value='';
      document.getElementById('expenseAmount').value='';
    };

    document.getElementById('addCategoryBtn').onclick=()=>{
      const val=document.getElementById('newCategory').value.trim();
      if(!val)return alert('Enter category name');
      if(categories.includes(val))return alert('Already exists');
      categories.push(val);
      saveAll();document.getElementById('newCategory').value='';
      renderCategories();
    };

    function deleteCategory(name){
      if(!confirm(`Delete category "${name}"?`))return;
      categories=categories.filter(c=>c!==name);
      saveAll();renderCategories();
    }

    function deleteExpense(i){
      if(confirm('Delete this expense?')){
        expenses.splice(i,1);saveAll();renderExpenses();
      }
    }

    categoryFilter.onchange=renderExpenses;
    timeFilter.onchange=renderExpenses;
    clearTime.onclick=()=>{timeFilter.value='';renderExpenses();};
    document.getElementById('logoutBtn').onclick=()=>{localStorage.removeItem('loggedInUser');location.href='login.html';};

    renderCategories();renderExpenses();
  </script>
</body>
</html>
