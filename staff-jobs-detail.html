<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Staff – Job Detail</title>

<style>
  :root {
    --bg:#0b111b;
    --card:rgba(255,255,255,0.05);
    --accent:#00b4ff;
    --text:#e2e8f0;
    --done:#22c55e;
  }

  body{background:var(--bg);margin:0;font-family:'Poppins',sans-serif;color:var(--text);}
  header{
    display:flex;justify-content:space-between;align-items:center;
    padding:15px 25px;background:rgba(255,255,255,0.06);
  }
  .logo{color:var(--accent);font-size:1.4rem;font-weight:700;}
  .btn-logout{
    background:#ef4444;color:white;border:none;padding:8px 16px;
    border-radius:8px;font-weight:600;cursor:pointer;
  }

  .container{
    max-width:900px;margin:25px auto;background:var(--card);
    padding:26px;border-radius:14px;
  }

  h1{text-align:center;color:var(--accent);}
  .cat-item{
    padding:10px;border-bottom:1px solid rgba(255,255,255,0.06);
    display:flex;justify-content:space-between;align-items:center;
  }
  .mark-btn{
    padding:6px 12px;border-radius:8px;border:none;
    cursor:pointer;font-weight:600;
  }
  .done{color:var(--done);font-weight:700;}
</style>

</head>

<body>

<header>
  <div class="logo">MG – Staff Panel</div>
  <button class="btn-logout" id="logoutBtn">Logout</button>
</header>

<div class="container">
  <h1 id="jobName">Job Detail</h1>
  <p id="jobType" style="text-align:center;color:#9bbad0;"></p>

  <h3 style="color:var(--accent);margin-top:25px;">Job Stages</h3>
  <div id="catList"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import {
    getFirestore, doc, getDoc, updateDoc
  } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC6BmLTjzOHwTa2VEYa9eYkClDtS__zvTM",
    authDomain: "mg-manager-3ab66.firebaseapp.com",
    projectId: "mg-manager-3ab66",
    storageBucket: "mg-manager-3ab66.appspot.com",
    messagingSenderId: "330667005987",
    appId: "1:330667005987:web:95de27b6259ace9fc6b996"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const jobId = localStorage.getItem("selectedJob");

  async function loadJob() {
    if (!jobId) return;

    const ref = doc(db, "jobs", jobId);
    const snap = await getDoc(ref);

    if (!snap.exists()) return;

    const data = snap.data();
    document.getElementById("jobName").textContent = data.name;
    document.getElementById("jobType").textContent = data.type;

    const container = document.getElementById("catList");
    container.innerHTML = "";

    data.categories.forEach((c, index) => {
      const div = document.createElement("div");
      div.className = "cat-item";

      div.innerHTML = `
        <div>
          <span style="font-size:1.1rem;">${c.name}</span>
          <div style="font-size:0.85rem;color:#9bbad0;">Stage</div>
        </div>
        <button class="mark-btn" id="btn${index}" 
          style="background:${c.done ? 'var(--done)' : 'var(--accent)'};">
          ${c.done ? "✓ Done" : "Mark Done"}
        </button>
      `;

      div.querySelector("button").onclick = () => toggleDone(index, data.categories);

      container.appendChild(div);
    });
  }

  async function toggleDone(i, cats) {
    cats[i].done = !cats[i].done;

    const ref = doc(db, "jobs", jobId);
    await updateDoc(ref, { categories: cats });

    loadJob();
  }

  document.getElementById("logoutBtn").onclick = () => {
    localStorage.removeItem("loggedInUser");
    window.location.href = "login.html";
  };

  loadJob();
</script>

</body>
</html>
